---
services:
  immich-exporter:
    image: ghcr.io/kryptionx/immich-prometheus-exporter:latest
    container_name: immich-exporter
    restart: unless-stopped
    environment:
      - IMMICH_URL=${IMMICH_URL}
      - IMMICH_API_KEY=${IMMICH_API_KEY}
      - EXPORTER_PORT=9700
      - SCRAPE_INTERVAL=60
    ports:
      - "9700:9700"
    healthcheck:
      test:
        [
          "CMD-SHELL",
          'python3 -c ''import urllib.request; urllib.request.urlopen("http://localhost:9700").read()'' || exit 1',
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
